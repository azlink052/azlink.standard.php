<Files ~ "^\.ht">
deny from all
</Files>

SetOutputFilter DEFLATE
BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4\.0[678] no-gzip
BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html
SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|ico|webp)$ no-gzip dont-vary
Header append Vary User-Agent env=!dont-vary

# AddType application/x-httpd-php .html
# Action myphp-script /php.cgi
# AddHandler myphp-script .php .html
# AddType application/x-httpd-php .php .html

<IfModule mod_rewrite.c>
  RewriteEngine On

  # RewriteCond %{HTTP_HOST} ^(www\.azlink\.jp) [NC]
  # RewriteRule ^(.*) https://azlink.jp/$1 [R=301,L]
  # RewriteCond %{HTTPS} !on
  # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

	RewriteCond %{HTTP_ACCEPT} image/webp
	RewriteCond %{REQUEST_FILENAME} (.*)\.(jpe?g|png|gif)$
	RewriteCond %{REQUEST_FILENAME}\.webp -f
	RewriteCond %{QUERY_STRING} !type=original
	RewriteRule (.+)\.(jpe?g|png|gif)$ %{REQUEST_FILENAME}.webp [T=image/webp,E=accept:1,L]

  # RewriteRule ^index\.php$ - [L]
  # RewriteCond %{REQUEST_FILENAME} !-f
  # RewriteCond %{REQUEST_FILENAME} !-d
  # RewriteCond %{THE_REQUEST} ^.*/index.(html|php)
  # RewriteRule ^(.*)index.(html|php)$ https://azlink.jp/$1 [R=301,L]

  # RewriteRule ^works/type/([0-9A-Za-z_]+/?)$ /works/index.html?type=$1 [L]
  # RewriteRule ^works/category/([0-9]+/?)$ /works/index.html?category=$1 [L]
  # RewriteRule ^works/page/([0-9]+/?)$ /works/index.html?paged=$1 [L]

  # RewriteRule ^works/type/([0-9A-Za-z_]+)/category/([0-9]+/?)$ /works/index.html?type=$1&category=$2 [L]
  # RewriteRule ^works/type/([0-9A-Za-z_]+)/page/([0-9]+/?)$ /works/index.html?type=$1&paged=$2 [L]
  # RewriteRule ^works/type/([0-9A-Za-z_]+)/category/([0-9]+)/page/([0-9]+/?)$ /works/index.html?type=$1&category=$2&paged=$3 [L]

  # RewriteRule ^works/preview/([0-9A-Za-z_]+/?)$ /works/index.html?preview=true&pass=$1 [L]

  RewriteRule ^form/thanks$ /form/index.php?mode=thanks [L]
</IfModule>

<IfModule mod_headers.c>
	Header append Vary Accept env=REDIRECT_accept
</IfModule>
AddType image/webp .webp
